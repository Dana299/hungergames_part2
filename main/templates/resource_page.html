<!DOCTYPE html>
{% extends 'base.html' %}

{% block content %}
    <div class="container mt-4">

        <h1 id="fullURL"></h1>
        <hr>

        <div id="resource-container">

        <div class="row gx-5">
            <div class="col-md-6 mb-4">
              <div class="bg-image hover-overlay ripple shadow-2-strong rounded-5" data-mdb-ripple-color="light">
                <img id="screenshotImg" src="" alt="Картинка" class="img-fluid">
                <a href="#!">
                  <div class="mask" style="background-color: rgba(251, 251, 251, 0.15);"></div>
                </a>
              </div>
            </div>

            <!-- Добавим блок с данными о веб-ресурсе -->
            <div class="col-md-6 mb-4">
                <div class="card bg-light mb-3">
                    <div class="card-header">
                        <p>Данные о веб ресурсе</p>
                    </div>
                    <div class="card-body">
                        <div class="d-flex justify-content-between">
                            <span>URL: </span><span id="fullURL">''</span>
                        </div>
                        <div class="d-flex justify-content-between">
                            <span>Протокол: </span><span id="protocol">''</span>
                        </div>
                        <div class="d-flex justify-content-between">
                            <span>Путь: </span><span id="urlPath">''</span>
                        </div>
                        <div class="d-flex justify-content-between">
                            <span>Домен: </span><span id="domain">''</span>
                        </div>
                        <div class="d-flex justify-content-between">
                            <span>Доменная зона: </span><span id="domainZone">''</span>
                        </div>
                        <div class="d-flex justify-content-between">
                            <span>Query-параметры: </span><span id="queryParams">''</span>
                        </div>
                    </div>
                  </div>
                <div>
                    <button onclick="history.back()" class="btn btn-primary">Назад</button>
                    <!-- <a href="/resources/" class="btn btn-primary">Назад к таблице ресурсов</a> -->
            </div>
          </div>

        </div>
    </div>

<script>

    document.addEventListener('DOMContentLoaded', function() {
        const resourceUUID = window.location.href.split('/').reverse()[0];

        getWebResourceData(resourceUUID);
      });

    function getWebResourceData(resourceUUID) {
        var xhr = new XMLHttpRequest();

        xhr.open('GET', '/api/resources/' + resourceUUID);
        console.log(resourceUUID);

        xhr.onload = function() {
        if (xhr.status === 200) {
            var resourceData = JSON.parse(xhr.responseText);
            // display response data and pagination block
            displayResourceData(resourceData);

        } else {
            console.error('Ошибка при получении данных веб-ресурса:', xhr.status);
        }
        };

        xhr.onerror = function() {
            console.error('Ошибка при выполнении запроса');
        };

        xhr.send();
    }

    function displayResourceData(resourceData) {
        const base64String = resourceData.screenshot;
        const dataURI = `data:image/png;base64,${base64String}`;
        const imgElement = document.getElementById('screenshotImg');
        imgElement.src = dataURI;

        const fullURLElement = document.getElementById('fullURL');
        fullURLElement.innerHTML = resourceData.url

        const protocolElement = document.getElementById('protocol');
        protocolElement.innerHTML = resourceData.protocol

        const domainElement = document.getElementById('domain');
        domainElement.innerHTML = resourceData.domain

        const urlPathElement = document.getElementById('urlPath');
        urlPathElement.innerHTML = resourceData.url_path

        const domainZoneElement = document.getElementById('domainZone');
        domainZoneElement.innerHTML = resourceData.domain_zone

    }

</script>
{% endblock %}
